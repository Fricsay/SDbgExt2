import "oaidl.idl";
import "ocidl.idl";
import "idl\_ClrTypes.idl";

interface IClrProcess;
typedef struct DctEntry
{
	CLRDATA_ADDRESS EntryPtr;
	CLRDATA_ADDRESS KeyPtr;
	CLRDATA_ADDRESS ValuePtr;
	ULONG32 HashCode;
} DctEntry;

typedef enum THREADPOOL_WORKITEM_TYPE 
{ 
	CB_TYPE_INVALID, 
	CB_TYPE_QUEUEUSERWORKITEM, 
	CB_TYPE_ASYNC_WORKITEM  
} THREADPOOL_WORKITEM_TYPE;

typedef struct ThreadPoolWorkItem
{
	CLRDATA_ADDRESS WorkItemPtr;
	CLRDATA_ADDRESS StatePtr;
	CLRDATA_ADDRESS DelegatePtr;
	CLRDATA_ADDRESS DelegateMethodDesc;
	THREADPOOL_WORKITEM_TYPE Type;
} ThreadPoolWorkItem;

[
	object,
	uuid(10D69AE4-80AA-4D87-AF18-86DD0010AA8C)
]
interface IEnumObjectsCallback : IUnknown
{
	HRESULT Callback([in] CLRDATA_ADDRESS obj, [in] ClrObjectData objData);
};

[
	object,
	uuid(FF9B39EB-CCAC-4AA2-B3C4-63BDDFA0AC9F)
]
interface IEnumHashtableCallback : IUnknown
{
	HRESULT Callback([in] DctEntry ent);
}

[
	object,
	uuid(0DAE7AEF-6671-48A0-AB96-D90931862882)
]
interface IEnumThreadPoolCallback : IUnknown
{
	HRESULT Callback([in] AppDomainAndValue queue, [in] ThreadPoolWorkItem item);
}

[
	object,
	uuid(1F0565EB-95CE-48DE-BC4A-54AD9C034A2C)
]
interface ISDbgExt : IUnknown
{
	HRESULT GetProcess([out, retval] IClrProcess **proc);
	HRESULT GetObjectData([in] CLRDATA_ADDRESS objAddr, [out, retval] ClrObjectData *data);
	HRESULT EvaluateExpression([in] CLRDATA_ADDRESS rootObj, [in, string] LPWSTR expression, [out, retval] CLRDATA_ADDRESS *result);
	
	HRESULT EnumStackObjects(DWORD corThreadId, IEnumObjectsCallback *cb);
	HRESULT EnumStackObjectsByThreadObj(CLRDATA_ADDRESS threadObj, IEnumObjectsCallback *cb);
	HRESULT EnumHeapObjects(IEnumObjectsCallback *cb);
	
	HRESULT EnumerateHashtable([in] CLRDATA_ADDRESS dctObj, [in] IEnumHashtableCallback *cb);
	HRESULT EnumerateThreadPoolQueues([in] IEnumThreadPoolCallback *tpQueueCb);
};

